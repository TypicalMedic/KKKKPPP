@model GalleryViewModel
@{
    if (UserViewModel.ExcHistory.Contains(Model.exc.id))
    {
        UserViewModel.ExcHistory.Remove(Model.exc.id);
        UserViewModel.ExcHistory.Add(Model.exc.id);
    }
    else
    {
        UserViewModel.ExcHistory.Add(Model.exc.id);
        if (UserViewModel.ExcHistory.Count > 5)
        {
            UserViewModel.ExcHistory.Remove(UserViewModel.ExcHistory.First());
        }
    }
}
<div class="row justify-content-center">
    <div class="col-10 row mt-3">
        <h1>"@Model.exc.Название"</h1>
        @if (Model.exc.Тип.Contains("User"))
        {
            <h4>Автор: @Model.allUsers.FirstOrDefault(u => u.Id.ToString() == Model.exc.Тип.Split('-')[1]).Name</h4>
        }
    </div>
    <div class="col-10 row mt-3">
        <h3>Об экскурсии</h3>
        <p class="lead">@Model.exc.Аннотация</p>
    </div>
    <form class="col-10 row mt-3" method="post" action="/Gallery/ExcursionFlow" name="Form">
        <input class="" required hidden name="value" value="@Model.exc.id" size="10" id="excurs" />
        <p>
            <input hidden name="picIndex" value="0" />
            <input hidden name="roomIndex" value="0" />
            <button class="btn btn-outline-success">Начать экскурсию</button>
        </p>
    </form>
    <div class="col-10 row mt-5">
        <div class="col-auto row align-items-end">
            <form class="col-6 p-0" method="post" action="/Gallery/LikeExcur">
                <input hidden name="id" value="@Model.exc.id" />
                @if (UserViewModel.userInfo != null && UserViewModel.userInfo.LikedExcurs.Contains(Model.exc.id))
                {
                    <input class="mb-3" type="image" style="width: 25px; height: auto" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/Emoji_u2665.svg/2048px-Emoji_u2665.svg.png" />
                    <input hidden name="act" value="dislike" />
                }
                else
                {
                    <input class="mb-3" type="image" style="width: 25px; height: auto" src="https://psv4.userapi.com/c534536/u173658598/docs/d23/b3c226347653/bed171f38bc538c188efa49f41318255.png?extra=soltoRP6C47mEG02JCO6g05JysHivWS9Mhzp4ZXGYk9C4yBmvVND4UTGJB5jijzTvtiaCJjNil2rPvit6M8ilY8z4yWJJnn9LPXVrQypk3RTqi-a6rXDcs8IBFmkXY-2Kb7Hyr1kTJU4WLABbq8g_aAu" />
                    <input hidden name="act" value="like" />
                }
            </form>
            <span class="lead col-6 mb-3">@Model.allExcurLikes.Where(e => e.ExcurId == Model.exc.id).Count()</span>
        </div>
        @if (User.Identity.IsAuthenticated)
        {
            <form class="col" method="post" action="/Gallery/LeaveCommentExcur">
                <input hidden name="id" value="@Model.exc.id" />
                <div class="d-flex">
                    <textarea required rows="3" name="comment" class="m-3 p-2 form-control flex-fill" placeholder="Оставьте комментарий..."></textarea>
                    <button class="mt-3 mb-3 p-2 align-self-end btn btn-outline-secondary flex-fill">Отправить</button>
                </div>
            </form>
        }
        else
        {
            <div class="col d-flex p-0 mx-1">
                <a class="mb-3 p-2 lead align-self-end flex-fill bd-highlight btn btn-outline-secondary" aria-current="page" href="/Account/Login">Чтобы оставить комментарий, авторизируйтесь</a>
            </div>
        }
    </div>
    <div class="col-10 row mt-5 align-items-end">
        <h4 class="p-0">Комментарии</h4>
        @if (Model.allExcurComments.Where(e => e.ExcurId == Model.exc.id).Count() > 0)
        {
            @foreach (var x in Model.allExcurComments.Where(e => e.ExcurId == Model.exc.id).OrderByDescending(c => c.PublishDate))
            {
                <p class="col-auto" align="Left" style="font-size: x-large; font-style: oblique">@Model.allUsers.FirstOrDefault(u => u.Id == x.UserId).Name:</p>
                <p class="col-auto  flex-grow-1 " align="Left" style="font-size: large">@x.Comment</p>
                <p class="col-auto" align="Left" style="font-size: medium; font-style: italic">@x.PublishDate.ToString()</p>
                <div class="dropdown-divider"></div>
                <div class="w-100"></div>
            }
        }
        else
        {
            <p class="lead col-auto p-0 flex-grow-1 mt-3" align="Left" style="font-size: large">Оставьте комментарий первым!</p>
        }
    </div>
</div>
<div class="fixed-bottom m-5 d-flex justify-content-end">
    <a href="#top" class="btn btn-outline-success">Наверх@*<img src="up.png" align=right>*@</a>
</div>